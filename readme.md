# Тестовое задание: Разработка микросервиса для подготовки дайджестов контента

## Якорь на описание работы сервиса

* [Описание](#описание)

## Цель

Разработайте микросервис, который будет формировать дайджесты контента для пользователей на основе их подписок. Дайджест представляет собой выборку постов из различных источников, на которые подписан пользователь. Вы можете выбрать любую технологию и форматы обмена данными.

## Требования к микросервису

1. Получение запроса на формирование дайджеста: Микросервис должен уметь принимать запросы от основного приложения на формирование дайджеста для пользователя, идентифицируемого по уникальному ID.

2. Определение подписок пользователя: После получения запроса, микросервис должен определить источники, на которые подписан пользователь, используя информацию о подписках пользователя.

3. Сбор постов из подписок: Зная подписки пользователя, микросервис должен собирать посты из этих источников. Подумайте о нём как о "сканере" подписок пользователя в поисках нового контента.

4. Фильтрация постов: Из собранных постов отфильтруйте те, которые не соответствуют интересам пользователя или недостаточно популярны. Микросервис должен использовать определенные критерии для фильтрации.

5. Создание дайджеста: После фильтрации, оставшиеся посты упаковываются в дайджест. Дайджест * это совокупность постов, отобранных для пользователя.

6. Отправка дайджеста: Сформированный дайджест возвращается в главное приложение, которое предоставит его пользователю.

## Структура данных

* Модель User: Хранит данные о пользователе, включая ID и имя.
* Модель Subscription: Содержит информацию о подписках пользователя, включая ID подписки, название источника и ID пользователя.
* Модель Post: Включает информацию о постах из подписок пользователя, включая ID поста, ID подписки, содержание поста и популярность.
* Модель Digest: Содержит информацию о сформированном дайджесте, включая ID дайджеста, список постов и ID пользователя.

## Дополнительные требования (по желанию)

* Использование Docker для создания контейнеризованного микросервиса.
* Использование SQLAlchemy для взаимодействия с базой данных.
* Использование RabbitMQ для асинхронной обработки запросов на формирование дайджеста.
* Написание автоматических тестов для проверки функциональности микросервиса.

## Критерии оценки

* Работоспособность микросервиса.
* Качество кода (организованность, чистота, следование стандартам).
* Соответствие функциональным требованиям.
* Реализация дополнительных требований (если выбраны).

Удачи в выполнении задания!
P.S. Все непонятные моменты интерпретируйте по своему усмотрению.
P.P.S. Спросили про сроки, это задание реально сделать за 2 дня. По факту у нас вышло около 80 строчек без моделей в бд, но, опять таки. Задание на джуниор разработчика, поэтому вы можете выкручиваться или сделать упрощенную версию от этой. Все обсуждаемо, можно даже обсудить сроки, если они будут аргументированы, но давайте в любом случае уважать время друг друга!
P.P.P.S. Вопросы задавать можно.

## Описание

Дайджесты контента на основе подписок, представляет собой выборку постов из различных источников. Выборка производится по подпискам и популярности контента.  
Базу наполняем из этого источника <https://newsapi.org/>  

Переделал то что было на фласке под раббит. (много всего обрезал, уже лень)

## Технологии

* Python 3.11
* Docker
* RabbitMQ
* SQLAlchemy
* requests==2.31.0
* loguru==0.7.0
* python-dotenv==1.0.0
* SQLite
* Black
* Isort

## Установка и запуск

* Клонируйте репозиторий и перейдити в него:

```zsh
git clone https://github.com/dimabaril/digest_on_rabbitmq.git
cd digest_on_rabbitmq
```

* Создайте виртальное окружение и зайдите в него:

```zsh
python3 -m venv venv
source venv/bin/activate
```

* Установите зависимости:

```zsh
pip install -r requirements.txt
```

* Поднимаем в докере рабита

```zsh
docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.12-management
```

* Если хотите понаполнять базу то идём на <https://newsapi.org>, регистрируемся и где то здесь <https://newsapi.org/account> получаем API key (если вам лень регаться то я залил базу на гит ;)
* Создайте файл .env и положите туда ваш API key таки образом

```.env
NEWSAPI_KEY="ваш_апи_кей_с_сайта_newsapi.org"
```

* Для заполнения БД выполните в терминале. Сервис созвонится с <https://newsapi.org> и заберёт там посты, параметры запроса вшиты в сервис и они такие:
(выбираем всё) "q": "*", (с даты) "from": "2023-07-21", (сортируем по популярности) "sortBy": "popularity". Популярности в чистом виде в постах у нас нет, в ответе приетает 100 постов отсортированных по популярности, для примера вернём популярность от 100 до 1 условных единиц. Юзеров он добавит сам, их id от 1 до 5. Ну и в завершении рандомайзом добавит юзерам подписки.

```zsh
python populate_database.py
```

* Запускаем сервис в 2х терминалах

```zsh
python requester.py (сюда отправляем user_id)
python responser.py
```

## Ограничения

* Апишка отдаёт порезанный контент, всего 200 символов.

## Автор

* Я
